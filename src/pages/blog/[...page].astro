---
import PostCard from "@components/PostCard.astro";
import CardGroup from "@components/temple/CardGroup.astro";
import Pagination from "@components/widgets/Pagination.astro";
import type { Page, Post } from "@interfaces/data";
import BaseLayout from "@layouts/BaseLayout.astro";
import { generatePageLinks } from "@utils/blogUtils";
import { getMainBlogPaginationPaths } from "@utils/paginationUtils";
import { Icon } from "astro-icon/components";

export async function getStaticPaths({ paginate }: { paginate: any }) {
  return getMainBlogPaginationPaths({ paginate });
}

const { page }: { page: Page } = Astro.props;

const totalPages = Math.ceil(page.total / page.size);
const pageLinks = generatePageLinks(totalPages);
---

<BaseLayout title="文章">
  <CardGroup cols="2">
    <a href="/blog/archives" class="card bg-base-100 shadow-lg">
      <div class="card-body p-4">
        <div class="flex items-center gap-3">
          <div class="rounded-full bg-accent/10 p-3">
            <Icon name="lucide:archive" class="w-6 h-6 text-accent" />
          </div>
          <div>
            <h2 class="card-title text-lg">归档</h2>
            <p class="text-sm opacity-75">按时间浏览全部文章</p>
          </div>
        </div>
      </div>
    </a>

    <a href="/blog/categories" class="card bg-base-100 shadow-lg">
      <div class="card-body p-4">
        <div class="flex items-center gap-3">
          <div class="rounded-full bg-primary/10 p-3">
            <Icon name="lucide:folder" class="w-6 h-6 text-primary" />
          </div>
          <div>
            <h2 class="card-title text-lg">分类</h2>
            <p class="text-sm opacity-75">按分类查看博客内容</p>
          </div>
        </div>
      </div>
    </a>

    <a href="/blog/tags" class="card bg-base-100 shadow-lg">
      <div class="card-body p-4">
        <div class="flex items-center gap-3">
          <div class="rounded-full bg-secondary/10 p-3">
            <Icon name="lucide:tag" class="w-6 h-6 text-secondary" />
          </div>
          <div>
            <h2 class="card-title text-lg">标签</h2>
            <p class="text-sm opacity-75">按标签筛选相关文章</p>
          </div>
        </div>
      </div>
    </a>

    <a href="/blog/search" class="card bg-base-100 shadow-lg">
      <div class="card-body p-4">
        <div class="flex items-center gap-3">
          <div class="rounded-full bg-info/10 p-3">
            <Icon name="lucide:search" class="w-6 h-6 text-info" />
          </div>
          <div>
            <h2 class="card-title text-lg">搜索</h2>
            <p class="text-sm opacity-75">搜索博客中的文章</p>
          </div>
        </div>
      </div>
    </a>
  </CardGroup>

  <CardGroup cols="1">
    {
      page.data.map((blog: Post) => (
        <PostCard
          title={blog.data.title}
          image={blog.data.image}
          description={blog.data.description}
          url={"/blog/" + blog.slug}
          pubDate={blog.data.pubDate}
          badge={blog.data.badge}
          categories={blog.data.categories}
          tags={blog.data.tags}
          word={blog.remarkPluginFrontmatter.totalCharCount}
          time={blog.remarkPluginFrontmatter.readingTime}
        />
      ))
    }
  </CardGroup>

  <Pagination page={page} totalPages={totalPages} pageLinks={pageLinks} baseUrl="/blog" />
</BaseLayout>