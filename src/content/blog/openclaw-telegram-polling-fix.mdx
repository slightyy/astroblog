---
title: 解决 OpenClaw Telegram Polling 不接收消息的问题
description: 记录一次 OpenClaw 更换 Telegram bot 后无法接收消息的排查过程，定位到是 polling offset 状态未重置导致的隐式问题。
pubDate: 2026-02-18
updated: 2026-02-18
draft: false
categories:
  - 技术笔记
tags:
  - OpenClaw
  - Telegram
  - 排障
---

# 解决 OpenClaw Telegram Polling 不接收消息的问题

在配置 OpenClaw 的过程中，我遇到了一次 Telegram polling 无法接收消息的问题，起因并不复杂，但定位花了一些时间，主要是因为状态本身没有任何明显异常。

## 背景

我最初的目标是使用第三方 AI API 接入 OpenClaw，而不是默认的 Codex 订阅。但在安装阶段误点了 Codex 的订阅流程，并完成了一次 Telegram bot 的绑定。这个状态下 OpenClaw 实际已经正常运行过一段时间，包括 Telegram polling 也确实收过消息。

后来我重新梳理配置，决定放弃 Codex，转而在 OpenClaw onboard 阶段重新配置第三方 AI API。同时，我也重新创建并绑定了新的 Telegram bot，并把原来的私聊/群组关系一并调整。表面上这是一次"干净的重新配置"，但实际上 OpenClaw 的本地状态并没有完全被重置。

## 问题现象

重新配置完成后，Control UI 中 Telegram channel 的状态看起来一切正常：

- channel 显示为已配置、运行中
- 模式为 polling
- probe 通过
- webhook 为空（符合 polling 预期）

Gateway 也可以正常访问，日志中没有报错。但不论是在 Telegram 中私聊 bot，还是在已经绑定的群组中发送消息，OpenClaw 都没有任何反应。

在 channel status 中可以看到，**lastInboundAt 一直为 null**。同时，通过 `openclaw logs --follow` 或 channel 相关日志，都看不到任何 Telegram inbound 的记录。

## 排查过程

最初我以为是以下问题：

- Telegram bot 权限问题
- 群组隐私设置
- 网络问题

为了确认 Telegram 本身是否有问题，我直接使用官方 API 验证了当前 bot token，通过 getUpdates 可以正常访问接口。在部分情况下，发送 `/start` 后也能看到更新返回。这基本可以排除 token 无效或 Telegram API 不可达的问题。

## 真正的原因

真正的问题出在 OpenClaw 本地的 polling 状态上。

在 polling 模式下，OpenClaw 会把 Telegram 的 update offset 持久化存储到本地目录中，路径位于：

```
~/.openclaw/telegram/update-offset-<accountId>.json
```

在我这个场景里，之前误安装 Codex 并绑定 Telegram 时，OpenClaw 已经用旧的 bot 跑过 polling，并把当时的 lastUpdateId 写入了 offset 文件。之后即便我在 onboard 阶段重新绑定了新的 Telegram bot（新的 token、新的 bot id），但仍然沿用了同一个 accountId（默认的 `default`），**这个 offset 文件并不会自动重置**。

结果就是，OpenClaw 在 polling 时继续使用一个来自"旧 bot"的 offset，而这个 offset 对于"新 bot"来说已经完全不合理。Telegram 的 getUpdates 只会返回 `update_id > offset` 的更新，于是 Telegram 返回空结果，OpenClaw 表现为 polling 正常、probe 正常，但始终没有任何 inbound 消息。

## 解决方法

手动重置 Telegram 的 update offset 状态：

```bash
# 检查本地 offset 文件
ls -la ~/.openclaw/telegram
cat ~/.openclaw/telegram/update-offset-default.json

# 移走做备份
mv ~/.openclaw/telegram/update-offset-default.json \
   ~/.openclaw/telegram/update-offset-default.json.bak

# 重启 gateway
openclaw gateway stop
openclaw gateway
```

重启完成后，在 Telegram 中重新给 bot 发送一条消息，再查看 channel status，可以看到 **lastInboundAt 正常更新**，日志中也出现了 Telegram inbound 的记录，消息能够顺利进入 agent 层。

## 经验总结

回头看这次问题，本质上并不是 Telegram、网络或第三方 AI API 的问题，而是一次"配置流程中断 + 本地状态复用"导致的隐式状态不一致。

只要在同一个 OpenClaw accountId 下更换过 Telegram bot，无论是误操作、重配还是切换订阅，都有可能遇到同样的情况。

### 建议

- 只要更换 Telegram bot，就同步清理对应 accountId 下的 offset 文件
- 或者为不同 bot 使用不同的 accountId
- 更理想的情况是，OpenClaw 在检测到 bot id 变化时能够主动提示或重置 offset

### 最小修复命令

```bash
mv ~/.openclaw/telegram/update-offset-default.json \
   ~/.openclaw/telegram/update-offset-default.json.bak 2>/dev/null || true
openclaw gateway stop
openclaw gateway
```

这类问题并不复杂，但如果不了解 polling offset 的持久化机制，很容易被"状态正常但没有消息"的表象带偏。记录下来，后面再遇到类似情况，基本可以快速定位。
